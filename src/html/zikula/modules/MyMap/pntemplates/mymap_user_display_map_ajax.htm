<!--[* fullscreen mode*]-->
<div id="mymap_closefullscreen<!--[$map.id]-->" class="mymap_closefullscreen" style="display: none; z-index: 1000;"><a href="#" onclick="javascript:$('mymap_graybackground<!--[$map.id]-->').hide();$('map<!--[$map.id]-->').setStyle({width: '<!--[$map.width]-->px',height: '<!--[$map.height]-->px',position:'relative',left: '0px',top: '0px','margin-left': '0px','margin-top': '0px','z-index': '0'});map<!--[$map.id]-->.resizeTo(<!--[$map.width]-->,<!--[$map.height]-->);$('mymap_closefullscreen<!--[$map.id]-->').hide();return false;" class="mymap_minimizelink"><!--[gt text="Minimize"]--></a></div>
<div id="mymap_graybackground<!--[$map.id]-->" class="mymap_graybackground" style="display: none; z-index: 890"></div>
<!--[* /fullscreen mode*]-->

<div id="mapheader<!--[$map.id]-->" style="width:<!--[$map.width]-->px;" class="mymap_mapheader">
	<div id="mymap_indicator_<!--[$map.id]-->" class="mymap_indicator" style="background-image: url(modules/MyMap/pnimages/ajax.gif)"></div>
	<div class="mymap_mapheader_title">
		<i><strong><!--[$map.title]--></strong></i>
		<a href="#" onclick="$('mymap_graybackground<!--[$map.id]-->').show();$('map<!--[$map.id]-->').setStyle({width: '1000px',height: '700px',position:'fixed',left: '50%',top: '50%','margin-left': '-500px','margin-top': '-350px','z-index': '900'});map<!--[$map.id]-->.resizeTo(1000,700);$('mymap_closefullscreen<!--[$map.id]-->').show();return false;"><!--[gt text="Fullscreen mode"]--></a>
	</div>
	<div id="mymap_mapcontrol<!--[$map.id]-->" class="mymap_mapheader_link">
		<a href="#" onclick="$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><!--[gt text="show mapControl"]--></a>
	</div>
	<div id="mymap_mapcontrolbox<!--[$map.id]-->" class="mymap_mapcontrol_menu" style="display: none;">
		<div id="mymap_menu">
			<div class="mymap_menu_border">
				<a class="mymap_menu_inside" href="#" onclick="$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><strong><!--[gt text="close menu"]--></strong></a>
				<a class="mymap_menu_inside" href="#" onclick="map<!--[$map.id]-->.removeAllMarkers();$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><!--[gt text="hide markers"]--></a>
				<a class="mymap_menu_inside" href="#" onclick="ajaxLoadMap('ajax.php?module=MyMap&func=JSONmap', map<!--[$map.id]-->,<!--[$map.id]-->,0,1);;$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><!--[gt text="show markers"]--></a>
				<a class="mymap_menu_inside" href="#" onclick="map<!--[$map.id]-->.removeAllPolylines();$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><!--[gt text="hide route"]--></a>
				<a class="mymap_menu_inside" href="#" onclick="ajaxLoadMap('ajax.php?module=MyMap&func=JSONmap', map<!--[$map.id]-->,<!--[$map.id]-->,1,0);$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();return false;"><!--[gt text="show route"]--></a>
				<!--[if $map.id gt 0]--><a class="mymap_menu_inside" href="<!--[pnmodurl modname="MyMap" type="user" func="export" mid=$map.id format='gpx']-->" onclick="$('mymap_graybackground<!--[$map.id]-->').show();$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();$('mymap_export<!--[$map.id]-->').show();change('<!--[pnmodurl modname="MyMap" type="user" func="export" mid=$map.id format='gpx']-->','mymap_export<!--[$map.id]-->');return false;"><!--[gt text="export gpx"]--></a>
				<a class="mymap_menu_inside" href="<!--[pnmodurl modname="MyMap" type="user" func="export" mid=$map.id format='kml']-->" onclick="$('mymap_graybackground<!--[$map.id]-->').show();$('mymap_mapcontrolbox<!--[$map.id]-->').toggle();$('mymap_mapcontrol<!--[$map.id]-->').toggle();$('mymap_export<!--[$map.id]-->').show();change('<!--[pnmodurl modname="MyMap" type="user" func="export" mid=$map.id format='kml']-->','mymap_export<!--[$map.id]-->');return false;"><!--[gt text="export kml"]--></a><!--[/if]-->
			</div>
		</div> <!-- mymap_menu -->
	</div> <!-- mymap_menubox -->
</div> <!-- mapheader -->

<div id="map<!--[$map.id]-->" style="background-color:#ffffff;width:<!--[$map.width]-->px;height:<!--[$map.height]-->px;"></div>

<div id="mymap_export<!--[$map.id]-->" class="mymap_exportpopup" style="position: fixed; display: none; z-index: 1100;">
	<!--[gt text="Please wait while the export data is beeing generated!"]--><br /><br /><br /><br />
	<img src="modules/MyMap/pnimages/ajax.gif" />
</div>

<!--[pnsecgenauthkey assign="authid"]-->
<script type="text/javascript">
	var map<!--[$map.id]--> = new Mapstraction('map<!--[$map.id]-->','<!--[$provider]-->');
	var centerpoint = new LatLonPoint(<!--[$map.centerlat]-->,<!--[$map.centerlng]-->);
	map<!--[$map.id]-->.setCenterAndZoom(centerpoint,<!--[$map.zoomfactor]-->);
 	map<!--[$map.id]-->.setMapType(Mapstraction.<!--[$map.maptype]-->);
 	map<!--[$map.id]-->.addControls({
		pan: true, 
		overview: <!--[$map_overview]-->,
		zoom: 'small',
		map_type: true 
		});
	map<!--[$map.id]-->.addEventListener('click', function(p) { 
		var point = p.toString();
		var coords = point.split(",");
		var newZoom = map<!--[$map.id]-->.getZoom() + 1;
<!--[if $clickzoom eq 1]-->
		map<!--[$map.id]-->.setCenterAndZoom(p,newZoom);
<!--[/if]-->
		$("lat").value = coords[0];	   
		$("lng").value = coords[1];
  	});

	map<!--[$map.id]-->.autoCenterAndZoom();
<!--[if ($markers|@count eq 1 and $waypoints|@count eq 0) or ($markers|@count eq 0 and $waypoints|@count eq 1)]-->
	map<!--[$map.id]-->.setZoom(<!--[$map.zoomfactor]-->);
<!--[/if]-->
	Event.observe(window, 'load', function(){ajaxLoadMap('ajax.php?module=MyMap&func=JSONmap', map<!--[$map.id]-->,<!--[$map.id]-->,1,1);}, false);
</script>

<!--[* Just for JS loading.. Will not display anything*]-->
<div id="mymap_wps_<!--[$map.id]-->"></div>
